
<form id="requestForm">
  <label for="employeeId">Employee ID</label>
  <input id="employeeId" name="employeeId" type="text" required />

  <label for="requestNumber">Request Number</label>
  <input id="requestNumber" name="requestNumber" type="text" required />

  <label for="attachment">Attachment</label>
  <input id="attachment" name="attachment" type="file" required />

  <button type="submit">Submit</button>
</form>

<pre id="status" class="status" aria-live="polite" style="white-space: pre-wrap;"></pre>

<script>
  async function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => {
        const [, base64] = reader.result.split(',');
        resolve(base64);
      };
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('requestForm');
    const responseEl = document.getElementById('status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const employeeId = document.getElementById('employeeId').value.trim();
      const requestNumber = document.getElementById('requestNumber').value.trim();
      const fileInput = document.getElementById('attachment');

      if (!employeeId || !requestNumber || !fileInput.files.length) {
        responseEl.className = 'error';
        responseEl.textContent = 'Please fill all fields and attach a file.';
        return;
      }

      const file = fileInput.files[0];
      if (file.size > 5 * 1024 * 1024) {
        responseEl.className = 'error';
        responseEl.textContent = 'File too large (max 5 MB).';
        return;
      }

      const fileBase64 = await fileToBase64(file);
      const payload = {
        EmployeeID: employeeId,
        RequestNumber: requestNumber,
        filename: 'Default',
        fileBase64
      };

      responseEl.className = '';
      responseEl.textContent = 'Submitting...';

      try {
        const res = await fetch('/api/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(() => ({}));
        responseEl.className = res.ok ? 'success' : 'error';
        responseEl.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        responseEl.className = 'error';
        responseEl.textContent = `Network error: ${err.message}`;
      }
    });
  });
</script>

<style>
  .success { color: #0a7; }
  .error   { color: #c00; }
</style>
